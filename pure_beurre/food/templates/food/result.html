{% extends 'food/index.html' %}

{% block header %}
	<header style="background-color: navy;
	margin-top: 70px;">
		<div class="container">
			<div class="row thumbnail ">
				<div class="mx-auto">
					<img src="{{ food.image.url }}">
				</div>	
			</div>
			
		</div>
	</header>
	
{% endblock %}

{% block sections %}
	<div class="container">
		<div class="text-center row">
			<div class="mx-auto">
				<h3 class="jumbotron">Vous pouvez remplacez cet aliment par...</h3>
			</div>
		</div>
		<div class="row">
			{% for food in foodSubtituts %}
			<div class="col-md-4 text-center is" style="border: 2px solid black;">
				<h3>{{ food.name }}</h3>
				<br>
				<div class="">
						<span class="icone">Q</span>
						<img src="{{ food.image.url }}">
				</div>
				{% if user.is_authenticated %}
				<div>
					<form method="POST" class="mx-auto" id="saveForm">
						{% csrf_token %}
						<input type="hidden" name="foodId" id="foodId" value="{{ food.id }}">
						<input type="hidden" name="userId" id="userId" value="{{ user.id }}">
						<span class="input-group-btn">
							<button type="submit" id="buttonSave">
								<span class="fas fa-save"></span>
								Sauvegarder
							</button>
						</span>
					</form>
				</div>
				{% endif %}
			</div>
		{% endfor %}
		</div>
	</div>

	<!-- Execute the javaScript only if a user is connected -->

	{% if user.is_authenticated %}
		<script type="text/javascript">
			$(function({
				function callAjax(f) {
					// recuperation des infos a envoyer

					var foodId = parseInt($('#foodId').attr('value'));

					// the ajax query
					$.ajax({
						url: '/food/saveFood/',
						dataType: 'json',
						data: {'foodId': foodId}
						type: 'POST',
						success: f,
						error: function(error){
							console.log(error);
						}
					});
				}

				function serverResponse(response) {
					data = JSON.parse(response);

					// recuperation des donnees renvoyees
					// par le serveur
					saved = data['saved'];
					alreadySaved = data['alreadySaved'];

					if(saved){
						alert("L\'aliment a bien ete enregistre...");
					}
					else if(alreadySaved){
						alert("L\'aliment existe deja en favoris");
					}
					else {
						alert('Une erreur est survenue...')
					}
				}

				$('#buttonSave').click(function(e) {
					e.preventDefault();
    				callAjax(serverResponse);
  				});
			});
		</script>
	{% endif %}
{% endblock %}